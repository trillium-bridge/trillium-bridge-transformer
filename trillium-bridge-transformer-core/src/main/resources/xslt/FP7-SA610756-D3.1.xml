<?xml version="1.0" encoding="UTF-8"?>
<map xmlns="http://trilliumbridge.org/xform" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:v3="urn:hl7-org:v3"> xsi:schemaLocation="http://trilliumbridge.org/xform
    file:/Users/mrf7578/Development/git/kevinpeterson/trillium-bridge-transformer/trillium-bridge-transformer-core/src/main/resources/xslt/TBXform.xsd">
        <entry from="epSOS" to="CCD" invertable="true">
        <documentation>The root template identifier needs to be changed from epSOS to CCD</documentation>
        <frompath>/ClinicalDocument/templateId</frompath>
        <topath>/ClinicalDocument/templateId</topath>
        <transformation name="changeTemplateRoots">
            <entry fromid="1.3.6.1.4.1.12559.11.10.1.3.1.1.3" toid="2.16.840.1.113883.10.20.22.1.2"/>
            <entry fromid="1.3.6.1.4.1.19376.1.5.3.1.1.1" toid="2.16.840.1.113883.10.20.22.1.1"/>
        </transformation>
    </entry>
    <entry from="epSOS" to="CCD" invertable="true">
        <frompath>/ClinicalDocument/id</frompath>
        <topath>/ClinicalDocument/id</topath>
        <transformation name="newid"/>
    </entry>
    <entry from="epSOS" to="CCD" invertable="true">
        <frompath>/ClinicalDocument/title</frompath>
        <topath>/ClinicalDocument/title</topath>
        <transformation name="translateTitle"/>
    </entry>
    <entry from="epSOS" to="CCD" invertable="true">
        <frompath>/ClinicalDocument/code</frompath>
        <topath>/ClinicalDocument/code</topath>
        <transformation name="mapValueSet" map="CCDtoEPSOSHeader"/>
    </entry>
    <entry from="epSOS" to="CCD" invertable="true">
        <frompath>/ClinicalDocument/component/structuredBody/component/section/templateId</frompath>
        <topath>/ClinicalDocument/component/structuredBody/component/section/templateId</topath>
        <transformation name="changeTemplateRoots">
            <entry fromid="2.16.840.1.113883.10.20.1.2" toid="2.16.840.1.113883.10.20.22.2.6"/>
            <entry fromid="1.3.6.1.4.1.19376.1.5.3.1.3.13" toid="2.16.840.1.113883.10.20.22.2.6.1"/>
        </transformation>
    </entry>
    <entry from="epSOS" to="CCD" invertable="true">
        <frompath>/ClinicalDocument/component/structuredBody/component/section/title</frompath>
        <topath>/ClinicalDocument/component/structuredBody/component/section/title</topath>
        <transformation name="translateTitle"/>
    </entry>
    <entry from="epSOS" to="CCD" invertable="true">
        <frompath>/ClinicalDocument/component/structuredBody/component/section/entry/act/code</frompath>
        <topath>/ClinicalDocument/component/structuredBody/component/section/entry/act/code</topath>
        <transformation name="replaceCode">
            <entry>
                <fromcode>
                    <code nullFlavor="NA" xmlns="urn:hl7-org:v3"/>
                </fromcode>
                <tocode>
                    <code code="48765-2" codeSystem="2.16.840.1.113883.6.1" codeSystemName="LOINC"
                        displayName="Allergies, adverse reactions, alerts" xmlns="urn:hl7-org:v3"/>
                </tocode>
            </entry>
        </transformation>
    </entry>
    <entry from="epSOS" to="CCD" invertable="true">
        <frompath>/ClinicalDocument/component/structuredBody/component/section/entry/act/templateId</frompath>
        <topath>/ClinicalDocument/component/structuredBody/component/section/entry/acttemplateId</topath>
        <transformation name="changeTemplateRoots">
            <entry fromid="2.16.840.1.113883.10.20.1.27" toid="2.16.840.1.113883.10.20.22.4.30"/>
            <entry fromid="1.3.6.1.4.1.19376.1.5.3.1.4.5.1"/>
            <entry fromid="1.3.6.1.4.1.19376.1.5.3.1.4.5.3"/>
        </transformation>
    </entry>
    <entry from="epSOS" to="CCD" invertable="true">
        <frompath>/ClinicalDocument/component/structuredBody/component/section/entry/act/entryRelationship/observation/templateId</frompath>
        <topath>/ClinicalDocument/component/structuredBody/component/section/entry/act/entryRelationship/observation/templateId</topath>
        <transformation name="changeTemplateRoots">
            <entry fromid="2.16.840.1.113883.10.20.1.18" toid="2.16.840.1.113883.10.20.22.4.7"/>
            <entry fromid="1.3.6.1.4.1.19376.1.5.3.1.4.6"/>
            <entry fromid="1.3.6.1.4.1.19376.1.5.3.1.4.5"/>
            <entry fromid="2.16.840.1.113883.10.20.1.28"/>
        </transformation>
    </entry>
    <entry from="epSOS" to="CCD" invertable="true">
        <frompath>/ClinicalDocument/component/structuredBody/component/section/entry/act/entryRelationship/observation/code</frompath>
        <topath>/ClinicalDocument/component/structuredBody/component/section/entry/act/entryRelationship/observation/code</topath>
        <transformation name="replaceCode">
            <entry>
                <tocode>
                    <code code="ASSERTION" codeSystem="2.16.840.1.113883.5.4" xmlns="urn:hl7-org:v3"/>
                </tocode>
            </entry>
        </transformation>
    </entry>
    <entry from="epSOS" to="CCD" invertable="true">
        <frompath>/ClinicalDocument/component/structuredBody/component/section/entry/act/entryRelationship/observation/value</frompath>
        <topath>/ClinicalDocument/component/structuredBody/component/section/entry/act/entryRelationship/observation/value</topath>
        <transformation name="replaceValue">
            <entry>
                <!--<fromValue>
                    <value xsi:type="CD" xmlns="urn:hl7-org:v3">
                        <originalText>
                            <reference value="#allergy.1"/>
                        </originalText>
                    </value>
                </fromValue>-->
                <toValue>
                    <value xsi:type="CD" code="416098002" displayName="Drug allergy"
                        codeSystem="2.16.840.1.113883.6.96" codeSystemName="SNOMED CT"  xmlns="urn:hl7-org:v3"/>
                </toValue>
            </entry>
        </transformation>
    </entry>
    <entry from="epSOS" to="CCD" invertable="true">
        <frompath>/ClinicalDocument/component/structuredBody/component/section/text</frompath>
        <topath>/ClinicalDocument/component/structuredBody/component/section/text</topath>
        <transformation name="translateText"/>
    </entry>
    
    
    
    <!--  
    
    <entry root="CCD" reference="7.1.1 Administrative Gender">
        <frompath>/recordTarget/patientRole/patient/administrativeGenderCode</frompath>
        <fromvalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.34</fromvalueset>
        <topath>/recordTarget/patientRole/patient/administrativeGenderCode</topath>
        <tovalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.34</tovalueset>
        <requirement>
            FRT1 - The transformation will have to change the template ID from epSOS to CCD for the data element Administative Gender as per the Xpaths, the rest of the structure remains the same.  There is no need to change the value as the value sets are identical.
        </requirement>
    </entry>
    <entry root="epSOS" reference="7.1.1 Administrative Gender">
        <frompath>/recordTarget/patientRole/patient/administrativeGenderCode</frompath>
        <fromvalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.34</fromvalueset>
        <topath>/recordTarget/patientRole/patient/administrativeGenderCode</topath>
        <tovalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.34</tovalueset>
        <requirement>
            FRT2 - The transformation will have to change the template ID from CCD to epSOS for the data element Administative Gender as per the Xpaths, the rest of the structure remains the same.  There is no need to change the value as the value sets are identical.
        </requirement>
    </entry>
    
    
    
    <entry root="epSOS" reference="7.1.2.1 Patient Country of Living">
        <frompath>/recordTarget/patientRole/addr/country</frompath>
        <fromvalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.4</fromvalueset>
        <topath>/recordTarget/patientRole/addr/country</topath>
        <tovalueset>2.16.840.1.113883.3.88.12.80.63</tovalueset>
        <requirement>
            FRT03 - The transformation will have to change the template ID from epSOS to CCD for the data element Country (Patient Country of Living) as per the Xpaths, the rest of the structure remains the same.  The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.2.8.
        </requirement>
    </entry>
    <entry root="CCD" reference="7.1.2.1 Patient Country of Living">
        <frompath>/recordTarget/patientRole/addr/country</frompath>
        <fromvalueset>2.16.840.1.113883.3.88.12.80.63</fromvalueset>
        <topath>/recordTarget/patientRole /addr/country</topath>
        <tovalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.4</tovalueset>
        <requirement>
            FRT04 - The transformation will have to change the template ID from CCD to epSOS for the data element Country (Patient Country of Living) as per the Xpaths, the rest of the structure remains the same.  The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.2.8.
        </requirement>
    </entry>
    <entry root="epSOS" reference="7.1.2.2 Guardian's Country">
        <frompath>/recordTarget/patientRole/addr/country</frompath>
        <fromvalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.4</fromvalueset>
        <topath>/recordTarget/patientRole/addr/country</topath>
        <tovalueset>2.16.840.1.113883.3.88.12.80.63</tovalueset>
        <requirement>
            FRT05 - The transformation will have to change the template ID from epSOS to CCD for the data element Country (Guardian’s Country) as per the Xpaths, the rest of the structure remains the same.  The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.2.8.
        </requirement>
    </entry>
    <entry root="CCD" reference="7.1.2.1 Guardian's Country">
        <frompath>/recordTarget/patientRole/patient/guardian/addr/country</frompath>
        <fromvalueset>2.16.840.1.113883.3.88.12.80.63</fromvalueset>
        <topath>/recordTarget/patientRole/patient/guardian/addr/country</topath>
        <tovalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.4</tovalueset>
        <requirement>
            FRT06 - The transformation will have to change the template ID from CCD to epSOS for the data element Country (Guardian’s Country) as per the Xpaths, the rest of the structure remains the same.  The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.2.8.
        </requirement>
    </entry>
    <entry root="epSOS" reference="7.1.2.3 Patient Contact's Country">
        <frompath>/participant/associatedEntity/addr/country</frompath>
        <topath/>
        <requirement>
            There is no conceptually equivalent structure, hence no transformation is possible.
        </requirement>
    </entry>
    <entry root="epSOS" reference="7.1.2.4 Prefered HCP/Legal Organization Country">
        <frompath>/participant/associatedEntity/addr/country</frompath>
        <frompath>/participant/associatedEntity/scopingOrganization/addr/country</frompath>
        <fromvalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.4</fromvalueset>
        <topath>/participant/associatedEntity/addr/country</topath>
        <tovalueset>2.16.840.1.113883.3.88.12.80.63</tovalueset>
        <requirement>
            FRT07 - The transformation will have to change the template ID and the structure from epSOS to CCD for the data element Country (Prefered HCP/ Legal Organization Country) as per the Xpaths. Please note that there are two possibilities to express the preferred HCP in epSOS as it is seen a point of contact for the patient. They both need to be mapped to the same element in CCD.  The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.2.8.
        </requirement>
    </entry>
    <entry root="CCD" reference="7.1.2.1 Guardian's Country">
        <frompath>/participant/associatedEntity/addr/country</frompath>
        <fromvalueset>2.16.840.1.113883.3.88.12.80.63</fromvalueset>
        <topath>/participant/associatedEntity/addr/country</topath>
        <topath>/participant/associatedEntity/scopingOrganization/addr/country</topath>
        <tovalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.4</tovalueset>
        <requirement>
            FRT08 - The transformation will have to change the template ID and the structure of the CCD to epSOS for the data element Country (Prefered HCP/ Legal Organization Country) as per the Xpaths. Please note that there are two possible ways in which the preferred HCP can be expressed in epSOS as it is seen as point of contact for the patient.  The CCD structure needs to map to both way of expression.  The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.2.8.
        </requirement>
    </entry>
    
    <entry root="epSOS" reference="7.1.2.5 Healthcare Facility's Country">
        <frompath>/author/assignedAuthor/representedOrganization/addr/country</frompath>
        <fromvalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.4</fromvalueset>
        <topath>/author/assignedAuthor/addr/country</topath>
        <tovalueset>2.16.840.1.113883.3.88.12.80.63</tovalueset>
        <requirement>
            FRT09 - The transformation will have to change the template ID from epSOS to CCD for the data element Country (Healthcare Facility’s Country) as per the Xpaths, the rest of the structure remains the same. An alternative is possible for expressing the same structure (see 7.1.2.5.3).  This must be supported as well. The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.2.8
        </requirement>
    </entry>
    <entry root="CCD" reference="7.1.2.5 Healthcare Facility's Country">
        <frompath>/author/assignedAuthor/representedOrganization/addr/country</frompath>
        <fromvalueset>2.16.840.1.113883.3.88.12.80.63</fromvalueset>
        <topath>/author/assignedAuthor/addr/country</topath>
        <tovalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.4</tovalueset>
        <requirement>
            FRT10 - The transformation will have to change the template ID from CCD to epSOS for the data element Country (Healthcare Facility’s Country) as per the Xpaths, the rest of the structure remains the same. An alternative is possible for expressing the same structure (see 7.1.2.5.3).  This must be supported as well.  The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.2.8.           
        </requirement>
    </entry>
    <entry root="epSOS" reference="7.1.2.5 Healthcare Facility's Country (alternate path)">
        <frompath>/documentationOf/serviceEvent/performer/assignedEntity/representedOrganization/addr/country</frompath>
        <fromvalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.4</fromvalueset>
        <topath>/documentationOf/serviceEvent/performer/assignedEntity/representedOrganization/addr/country</topath>
        <tovalueset>2.16.840.1.113883.3.88.12.80.63</tovalueset>
        <requirement>
            FRT11 - The transformation will have to change the template ID from epSOS to CCD for the data element Country (Healthcare Facility’s Country) as per the Xpaths, the rest of the structure remains the same. An alternative is possible for expressing the same structure (see 7.1.2.5.1).  This must be supported as well.  The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.2.8.
        </requirement>
    </entry>
    <entry root="CCD" reference="7.1.2.5 Healthcare Facility's Country (alternate path)">
        <frompath>/documentationOf/serviceEvent/performer/assignedEntity/representedOrganization/addr/country</frompath>
        <fromvalueset>2.16.840.1.113883.3.88.12.80.63</fromvalueset>
        <topath>/documentationOf/serviceEvent/performer/assignedEntity/representedOrganization/addr/country</topath>
        <tovalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.4</tovalueset>
        <requirement>    
            FRT12 - The transformation will have to change the template ID from CCD to epSOS for the data element Country (Healthcare Facility’s Country) as per the Xpaths, the rest of the structure remains the same.  An alternative is possible for expressing the same structure (see 7.1.2.5.1).  This must be supported as well. The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.2.8.
        </requirement>
    </entry>
    
    <entry root="epSOS" reference="7.1.2.6 Author Organization Country">
        <frompath>/author/assignedAuthor/representedOrganization/addr/country</frompath>
        <frompath>/documentationOf/serviceEvent/performer/assignedEntity/representedOrganization/addr/country</frompath>
        <requirement>
            not present in the CCD document
         </requirement>
    </entry>
    
    <entry root="epSOS" reference="7.1.2.7  Legal Authenticator Country">
        <frompath>/legalAuthenticator/assignedEntity/assignedPerson/addr/country</frompath>
        <frompath>/legalAuthenticator/assignedEntity/representedOrganization/addr/country</frompath>
        <fromvalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.4</fromvalueset>
        <topath>/legalAuthenticator/assignedEntity/addr/country</topath>
        <tovalueset>2.16.840.1.113883.3.88.12.80.63</tovalueset>
        <requirement>
            FRT13 - The transformation will have to change the template ID from epSOS to CCD for the data element Country (Legal Authenticator Country) as per the Xpaths.   Please note that there are two possibilities to express the legal authenticator in epSOS. They both need to be mapped to the same element in CCD. The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.2.8.
        </requirement>
    </entry>
    <entry root="CCD" reference="7.1.2.7  Legal Authenticator Country">
        <frompath>/legalAuthenticator/assignedEntity/addr/country</frompath>
        <fromvalueset>2.16.840.1.113883.3.88.12.80.63</fromvalueset>
        <topath>/legalAuthenticator/assignedEntity/assignedPerson/addr/country</topath>
        <topath>/legalAuthenticator/assignedEntity/representedOrganization/addr/country</topath>
        <tovalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.4</tovalueset>
        <requirement>    
            FRT14 - The transformation will have to change the template ID from CCD to epSOS for the data element Country (Legal Authenticator Country) as per the Xpaths.  Please note that there are two possible ways in which the legal authenticator can be expressed in epSOS.  The CCD structure needs to map to both way of expression.  The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.2.8.
        </requirement>
    </entry>
    
    <entry root="epSOS" reference="7.1.3  EntityNamePartQualifier">
        <frompath>/recordTarget/patientRole/patient/name/prefix</frompath>
        <fromvalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.33</fromvalueset>
        <topath>/recordTarget/patientRole/patient/name/prefix</topath>
        <tovalueset>2.16.840.1.113883.11.20.9.26</tovalueset>
        <requirement>
            FRT15 - The transformation will have to change the template ID from epSOS to CCD for the data element EntityNamePartQualifier as per the Xpaths, the rest of the structure remains the same.  The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.3.3.
        </requirement>
    </entry>
    <entry root="CCD" reference="7.1.2.7  Legal Authenticator Country">
        <frompath>/legalAuthenticator/assignedEntity/addr/country</frompath>
        <fromvalueset>2.16.840.1.113883.3.88.12.80.63</fromvalueset>
        <topath>/legalAuthenticator/assignedEntity/assignedPerson/addr/country</topath>
        <topath>/legalAuthenticator/assignedEntity/representedOrganization/addr/country</topath>
        <tovalueset>1.3.6.1.4.1.12559.11.10.1.3.1.42.4</tovalueset>
        <requirement>    
            FRT16 - The transformation will have to change the template ID from CCD to epSOS for the data element EntityNamePartQualifier as per the Xpaths, the rest of the structure remains the same.  The mapping providing a common vocabulary for the value of this data element from the CTS2 server is listed in section 7.1.3.3.
        </requirement>
    </entry>-->
</map>
